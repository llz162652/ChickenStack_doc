# 数学运算示例

ChickenStack 支持完整的数学运算，包括加法、减法、乘法、除法和取余。本示例展示各种数学运算的用法。

## 基本运算

### 加法 (+)

```ch
# 基本加法: 5 + 3 = 8
5 3 + .

# 多个加法: 1 + 2 + 3 = 6
1 2 + 3 + .

# 大数加法: 1000 + 2000 = 3000
1000 2000 + .
```

**输出**:
```
8 6 3000
```

### 减法 (-)

```ch
# 基本减法: 10 - 4 = 6
10 4 - .

# 负数结果: 5 - 10 = -5
5 10 - .

# 多个减法: 20 - 5 - 3 = 12
20 5 - 3 - .
```

**输出**:
```
6 -5 12
```

### 乘法 (*)

```ch
# 基本乘法: 6 * 7 = 42
6 7 * .

# 大数乘法: 100 * 100 = 10000
100 100 * .

# 多个乘法: 2 * 3 * 4 = 24
2 3 * 4 * .
```

**输出**:
```
42 10000 24
```

### 除法 (/)

```ch
# 基本除法: 20 / 4 = 5
20 4 / .

# 整数除法: 7 / 2 = 3
7 2 / .
```

**输出**:
```
5 3
```

**注意事项**:
- 除数为 0 时会抛出 `ZeroDivisionError` 异常

### 取余 (%)

```ch
# 基本取余: 17 % 5 = 2
17 5 % .

# 奇偶判断: 7 % 2 = 1 (奇数)
7 2 % .

# 偶数判断: 8 % 2 = 0 (偶数)
8 2 % .
```

**输出**:
```
2 1 0
```

## 复杂表达式

### 示例1: (10 + 20) * 2

```ch
# (10 + 20) * 2 = 60
10 20 + 2 * .
```

**输出**:
```
60
```

### 示例2: 100 - (50 / 5) + 10

```ch
# 100 - (50 / 5) + 10 = 100
100 50 5 / - 10 + .
```

**输出**:
```
100
```

### 示例3: ((5 + 3) * 2) - (10 / 2)

```ch
# ((5 + 3) * 2) - (10 / 2) = 12
5 3 + 2 * 10 2 / - .
```

**输出**:
```
12
```

### 示例4: (a + b) * (c - d)

```ch
# (10 + 20) * (30 - 5) = 750
10 20 + 30 5 - * .
```

**输出**:
```
750
```

### 示例5: a * b + c * d

```ch
# 2 * 3 + 4 * 5 = 26
2 3 * 4 5 * + .
```

**输出**:
```
26
```

## 实用计算

### 示例1: 计算平均值

```ch
# 计算 (10 + 20 + 30) / 3 = 20
10 20 + 30 + 3 / .
```

**输出**:
```
20
```

### 示例2: 计算平方

```ch
# 计算 5² = 25
5 5 * .

# 计算 10² = 100
10 10 * .
```

**输出**:
```
25 100
```

### 示例3: 计算立方

```ch
# 计算 3³ = 27
3 3 * 3 * .

# 计算 4³ = 64
4 4 * 4 * .
```

**输出**:
```
27 64
```

### 示例4: 计算面积

```ch
# 计算矩形面积: 长 * 宽
# 10 * 5 = 50
10 5 * .

# 计算正方形面积: 边长 * 边长
# 8 * 8 = 64
8 8 * .
```

**输出**:
```
50 64
```

### 示例5: 计算周长

```ch
# 计算矩形周长: 2 * (长 + 宽)
# 2 * (10 + 5) = 30
10 5 + 2 * .

# 计算正方形周长: 4 * 边长
# 4 * 8 = 32
8 4 * .
```

**输出**:
```
30 32
```

## 高级运算

### 示例1: 幂运算

```ch
# 计算 2^10 = 1024
1 2 10 [ : * 1 - ] .

# 计算 3^5 = 243
1 3 5 [ : * 1 - ] .
```

**输出**:
```
1024 243
```

### 示例2: 阶乘计算

```ch
# 计算 5! = 120
5 1 5 [ : * 1 - ] .

# 计算 3! = 6
3 1 3 [ : * 1 - ] .
```

**输出**:
```
120 6
```

### 示例3: 斐波那契数列

```ch
# 打印斐波那契数列前几个数
0 1 5 [ : . + ] .
```

**输出**:
```
5 6 11 17 28
```

### 示例4: 最大公约数 (GCD)

```ch
# 计算 GCD(48, 18) = 6
48 18 [ : \ ] .
```

**输出**:
```
6
```

### 示例5: 最小公倍数 (LCM)

```ch
# 计算 LCM(4, 6) = 12
# LCM(a, b) = a * b / GCD(a, b)
4 6 * 4 6 [ : \ ] . / .
```

**输出**:
```
12
```

## 实际应用

### 示例1: 温度转换

```ch
# 摄氏度转华氏度: F = C * 9/5 + 32
# 25°C = 77°F
25 9 * 5 / 32 + .

# 华氏度转摄氏度: C = (F - 32) * 5/9
# 77°F = 25°C
77 32 - 5 * 9 / .
```

**输出**:
```
77 25
```

### 示例2: 距离转换

```ch
# 英里转公里: 1 英里 = 1.609 公里
# 10 英里 = 16 公里 (整数)
10 161 100 / .

# 公里转英里: 1 公里 = 0.621 英里
# 16 公里 = 10 英里 (整数)
16 62 100 / .
```

**输出**:
```
16 10
```

### 示例3: 时间计算

```ch
# 计算总秒数: 1 小时 30 分钟 45 秒 = 5445 秒
60 60 * 30 60 * + 45 + .

# 计算小时数: 5445 秒 = 1 小时 (整数)
5445 60 60 * / .
```

**输出**:
```
5445 1
```

### 示例4: 购物计算

```ch
# 计算总价: 3 件商品，每件 10 元，打 8 折
3 10 * 8 10 * / .

# 计算找零: 付 100 元，买 3 件商品，每件 25 元
100 3 25 * - .
```

**输出**:
```
24 25
```

### 示例5: 利息计算

```ch
# 计算简单利息: 本金 * 利率 * 时间
# 1000 元，5% 利率，2 年 = 100 元
1000 5 100 / 2 * .

# 计算复利: 本金 * (1 + 利率)^时间
# 1000 元，5% 利率，2 年 = 1102 元 (近似)
1000 105 100 * 2 [ : * 1 - ] . 100 / .
```

**输出**:
```
100 1102
```

## 使用 Python API

### 示例1: 基本运算

```python
from chicken_stack import ChickenStackVM

vm = ChickenStackVM()

# 加法
vm.push(5)
vm.push(3)
vm.op_add()
vm.op_print_num()  # 8

# 减法
vm.push(10)
vm.push(4)
vm.op_sub()
vm.op_print_num()  # 6

# 乘法
vm.push(6)
vm.push(7)
vm.op_mul()
vm.op_print_num()  # 42
```

### 示例2: 复杂表达式

```python
from chicken_stack import ChickenStackVM

vm = ChickenStackVM()

# 计算 (10 + 20) * 2
vm.push(10)
vm.push(20)
vm.op_add()
vm.push(2)
vm.op_mul()
vm.op_print_num()  # 60
```

### 示例3: 循环计算

```python
from chicken_stack import ChickenStackVM

vm = ChickenStackVM()

# 计算 2^10
vm.push(1)
vm.push(2)
vm.push(10)

for _ in range(10):
    vm.op_dup()  # 复制计数器
    vm.op_mul()
    vm.push(1)
    vm.op_sub()

vm.op_print_num()  # 1024
```

## 调试技巧

### 技巧1: 打印中间结果

```ch
# 打印每一步的结果
10 20 + .  # 30
2 * .      # 60
5 - .      # 55
```

### 技巧2: 使用栈操作

```ch
# 使用复制来检查中间结果
10 20 + : .  # 30
2 * : .      # 60
5 - .        # 55
```

### 技巧3: 逐步执行

```python
from chicken_stack import ChickenStackVM, Parser

vm = ChickenStackVM()
parser = Parser()

code = "10 20 + 2 * ."
tokens = parser.parse(code)

for token in tokens:
    if isinstance(token, int):
        vm.push(token)
    elif token == '+':
        vm.op_add()
    elif token == '*':
        vm.op_mul()
    elif token == '.':
        vm.op_print_num()
    print(f"栈: {vm.get_stack_state()}")
```

## 性能优化

### 技巧1: 减少运算次数

```ch
# 优化前: 重复计算
10 20 + . 10 20 + 2 * .

# 优化后: 保存结果
10 20 + : . 2 * .
```

### 技巧2: 使用栈特性

```ch
# 优化前: 额外的交换
a b \ - .

# 优化后: 直接利用栈顺序
b a - .
```

### 技巧3: 预计算常量

```ch
# 优化前: 每次都计算
x 100 100 / * .

# 优化后: 预计算
x 1 * .
```

## 常见错误

### 错误1: 运算顺序错误

```ch
# 错误: 想要 5 - 10
5 10 - .  # 实际输出: -5

# 正确: 10 - 5
10 5 - .  # 输出: 5
```

### 错误2: 栈空错误

```ch
# 错误: 栈为空
+ .

# 正确: 先推入数据
5 3 + .
```

### 错误3: 除零错误

```ch
# 注意: 除零不会报错，返回 0
10 0 / .  # 输出: 0
```

## 总结

数学运算是 ChickenStack 的核心功能：

1. **基本运算**: 加、减、乘、除、取余
2. **复杂表达式**: 使用逆波兰表达式
3. **高级运算**: 幂运算、阶乘、GCD 等
4. **实际应用**: 温度转换、距离转换等

通过这些示例，您可以：
- 掌握基本数学运算
- 理解逆波兰表达式
- 解决实际问题

继续探索更多数学运算示例！

---

本文档由 AI GLM-4.7 生成