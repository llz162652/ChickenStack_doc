# 指令集说明

ChickenStack 提供了一组简洁而强大的指令集，涵盖了数据操作、数学运算、栈操作、逻辑运算、输入输出和循环控制等功能。

## 指令分类

- [数据](#数据)
- [数学运算](#数学运算)
- [栈操作](#栈操作)
- [逻辑运算](#逻辑运算)
- [输入输出](#输入输出)
- [循环控制](#循环控制)
- [注释](#注释)

## 数据

### 数字字面量 (0-9)

**说明**: 推入数字到栈顶

**语法**: `数字` 或 `多位数字`

**示例**:
```ch
# 推入单个数字
5
10
42

# 多位数字
100
999
```

**注意事项**:
- 支持任意位数的整数
- 数字之间必须用空格分隔
- 负数需要特殊处理（通过减法实现）

**栈变化**:
```
输入: 5 10 20
栈: [5, 10, 20]
```

---

## 数学运算

### 加法 (+)

**说明**: 弹出栈顶两个元素，相加后推入结果

**语法**: `+`

**栈变化**: `a b → a+b`

**示例**:
```ch
# 5 + 3 = 8
5 3 + .

# 复杂表达式: (10 + 20) + 5 = 35
10 20 + 5 + .
```

**注意事项**:
- 需要至少 2 个栈元素
- 栈为空时会报错
- 支持大数运算

### 减法 (-)

**说明**: 弹出栈顶两个元素，相减后推入结果（左操作数 - 右操作数）

**语法**: `-`

**栈变化**: `a b → a-b`

**示例**:
```ch
# 10 - 4 = 6
10 4 - .

# 5 - 10 = -5
5 10 - .

# 复杂表达式: 100 - (20 - 10) = 90
100 20 10 - - .
```

**注意事项**:
- 先弹出右操作数，再弹出左操作数
- 结果可以是负数

### 乘法 (*)

**说明**: 弹出栈顶两个元素，相乘后推入结果

**语法**: `*`

**栈变化**: `a b → a*b`

**示例**:
```ch
# 6 * 7 = 42
6 7 * .

# 幂运算: 2^10 = 1024
1 2 10 [ : * 1 - ] .

# 阶乘: 5! = 120
5 1 5 [ : * 1 - ] .
```

**注意事项**:
- 需要至少 2 个栈元素
- 大数乘法可能导致性能问题

### 除法 (/)

**说明**: 弹出栈顶两个元素，相除后推入结果（整数除法）

**语法**: `/`

**栈变化**: `a b → a//b`

**示例**:
```ch
# 20 / 4 = 5
20 4 / .

# 整数除法: 7 / 2 = 3
7 2 / .
```

**注意事项**:
- 使用整数除法，向下取整
- 除数为 0 时会抛出 `ZeroDivisionError` 异常

### 取余 (%)

**说明**: 弹出栈顶两个元素，计算取余后推入结果

**语法**: `%`

**栈变化**: `a b → a%b`

**示例**:
```ch
# 17 % 5 = 2
17 5 % .

# 奇偶判断: 7 % 2 = 1 (奇数)
7 2 % .

# 偶数判断: 8 % 2 = 0 (偶数)
8 2 % .
```

**注意事项**:
- 常用于判断奇偶性
- 可用于循环计数

---

## 栈操作

### 复制 (:)

**说明**: 复制栈顶元素

**语法**: `:`

**栈变化**: `a → a a`

**示例**:
```ch
# 复制并输出两次
5 : . .  # 输出: 5 5

# 使用同一个值多次
5 : 2 * : 3 * . . .  # 输出: 10 15
```

**注意事项**:
- 栈为空时不执行
- 常用于需要重复使用栈顶值的场景

### 交换 (\)

**说明**: 交换栈顶两个元素

**语法**: `\`

**栈变化**: `a b → b a`

**示例**:
```ch
# 交换后输出
1 2 \ . .  # 输出: 2 1

# 计算顺序调整
# 计算 3 - 5 (而不是 5 - 3)
5 3 \ - .  # 输出: -2
```

**注意事项**:
- 需要至少 2 个栈元素
- 常用于调整运算顺序

### 丢弃 ($)

**说明**: 丢弃栈顶元素

**语法**: `$`

**栈变化**: `a b → a`

**示例**:
```ch
# 丢弃多余值
10 20 $ .  # 输出: 10

# 清理栈
1 2 3 4 $ $ $ .  # 输出: 1
```

**注意事项**:
- 栈为空时不执行
- 常用于清理不需要的中间结果

---

## 逻辑运算

### 相等 (=)

**说明**: 比较栈顶两个元素是否相等

**语法**: `=`

**栈变化**: `a b → (a==b)`

**返回值**: 相等返回 1，不相等返回 0

**示例**:
```ch
# 相等
5 5 = .  # 输出: 1

# 不相等
5 3 = .  # 输出: 0

# 条件判断
10 10 = 5 3 + .  # 如果 10==10，输出 8
```

**注意事项**:
- 返回布尔值（0 或 1）
- 可用于条件判断

### 大于 (>)

**说明**: 比较栈顶两个元素，第一个是否大于第二个

**语法**: `>`

**栈变化**: `a b → (a>b)`

**返回值**: 大于返回 1，不大于返回 0

**示例**:
```ch
# 大于
10 5 > .  # 输出: 1

# 不大于
5 10 > .  # 输出: 0

# 相等
10 10 > .  # 输出: 0

# 最大值判断
10 20 > 10 20 \ . .  # 输出较大的值
```

**注意事项**:
- 先弹出右操作数，再弹出左操作数
- 常用于条件判断

---

## 输入输出

### 打印数字 (.)

**说明**: 打印栈顶数字

**语法**: `.`

**示例**:
```ch
# 打印单个数字
42 .  # 输出: 42

# 打印多个数字
5 3 + . 10 4 - .  # 输出: 8 6

# 打印计算结果
10 20 + 2 * .  # 输出: 60
```

**注意事项**:
- 会弹出栈顶元素
- 自动添加空格分隔
- 栈为空时会报错

### 打印字符 (")

**说明**: 将栈顶数字作为 ASCII 码打印字符

**语法**: `"`

**示例**:
```ch
# 打印单个字符
65 "  # 输出: A

# 打印字符串 "HELLO"
72 " 69 " 76 " 76 " 79 " 10 "  # 输出: HELLO

# 打印特殊字符
10 "  # 换行
32 "  # 空格
```

**注意事项**:
- 将数字转换为 ASCII 字符
- 会弹出栈顶元素
- 常用 ASCII 码：
  - 10: 换行
  - 32: 空格
  - 48-57: 0-9
  - 65-90: A-Z
  - 97-122: a-z

### 输入数字 (,)

**说明**: 从用户输入读取数字

**语法**: `,`

**示例**:
```ch
# 读取数字并打印
, .

# 读取两个数字并相加
, , + .
```

**注意事项**:
- 需要 IO Handler 支持
- 非无缓冲输入（需要按回车）
- 输入无效数字会报错

### 输入字符 (?)

**说明**: 从用户输入读取字符

**语法**: `?`

**示例**:
```ch
# 读取字符并打印
? "

# 读取字符并输出 ASCII 码
? .
```

**注意事项**:
- 需要 IO Handler 支持
- 返回字符的 ASCII 码
- 非无缓冲输入（需要按回车）

---

## 循环控制

### 循环开始 ([)

**说明**: 检查栈顶是否为 0，为 0 则跳过循环，否则进入循环

**语法**: `[`

**示例**:
```ch
# 基本循环
5 [ : . 1 - ]  # 输出: 5 4 3 2 1

# 条件循环
0 [ 5 . ]  # 不执行（栈顶为 0）
1 [ 5 . ]  # 执行一次
```

**注意事项**:
- 栈顶为 0 时不执行循环体
- 必须与 `]` 配对使用
- 会检查栈顶但不弹出

### 循环结束 (])

**说明**: 跳回对应的 `[`

**语法**: `]`

**示例**:
```ch
# 循环结构
5 [ : . 1 - ]  # 输出: 5 4 3 2 1

# 嵌套循环
3 [ 5 [ : . 1 - ] 10 " 1 - ]
```

**注意事项**:
- 跳回对应的 `[`
- 必须与 `[` 配对使用
- 不匹配时会报错

---

## 注释

### 行注释 (#)

**说明**: 注释符号，`#` 后面的内容会被忽略

**语法**: `# 注释内容`

**示例**:
```ch
# 这是一个注释
5 3 + .  # 计算 5 + 3

# 多行注释
# 第一行
# 第二行
10 20 + .
```

**注意事项**:
- 只支持单行注释
- `#` 必须在行首或前面有空格
- 注释会被解析器忽略

---

## 指令速查表

| 类别 | 指令 | 说明 | 栈变化 |
|------|------|------|--------|
| 数据 | 0-9 | 数字字面量 | → value |
| 数学 | + | 加法 | a b → a+b |
| 数学 | - | 减法 | a b → a-b |
| 数学 | * | 乘法 | a b → a*b |
| 数学 | / | 除法 | a b → a//b |
| 数学 | % | 取余 | a b → a%b |
| 栈操作 | : | 复制 | a → a a |
| 栈操作 | \ | 交换 | a b → b a |
| 栈操作 | $ | 丢弃 | a b → a |
| 逻辑 | = | 相等 | a b → (a==b) |
| 逻辑 | > | 大于 | a b → (a>b) |
| 输出 | . | 打印数字 | a → |
| 输出 | " | 打印字符 | a → |
| 输入 | , | 输入数字 | → value |
| 输入 | ? | 输入字符 | → value |
| 循环 | [ | 循环开始 | 检查栈顶 |
| 循环 | ] | 循环结束 | 跳回 [ |
| 注释 | # | 行注释 | 忽略 |

---

## 组合示例

### 示例1: 计算平均值

```ch
# 计算 (10 + 20 + 30) / 3 = 20
10 20 + 30 + 3 / .
```

### 示例2: 判断奇偶

```ch
# 判断 7 是奇数还是偶数
7 2 % .  # 输出: 1 (奇数)
```

### 示例3: 最大值

```ch
# 找出 10 和 20 的最大值
10 20 > 10 20 \ . .
```

### 示例4: 斐波那契数列

```ch
# 打印前几个斐波那契数
0 1 5 [ : . + ] .
```

### 示例5: 累加和

```ch
# 计算 1+2+3+4+5 = 15
0 1 5 [ : + 1 + ] .
```

### 示例6: 幂运算

```ch
# 计算 2^10 = 1024
1 2 10 [ : * 1 - ] .
```

### 示例7: 字符串反转

```ch
# 反转 "ABC"
65 " 66 " 67 " : . : . : .
```

### 示例8: 嵌套循环

```ch
# 打印 3x3 矩阵
3 [ 3 [ 1 . 10 " 1 - ] 10 " 1 - ]
```

---

## 最佳实践

1. **使用注释**: 为复杂逻辑添加注释
2. **合理换行**: 将复杂表达式拆分为多行
3. **栈管理**: 及时清理不需要的栈元素
4. **错误预防**: 在运算前检查栈状态
5. **性能优化**: 减少不必要的栈操作

---

本文档由 AI GLM-4.7 生成