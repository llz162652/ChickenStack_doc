# 语法规则

ChickenStack 的语法简洁而强大，基于逆波兰表达式（后缀表达式）。本文档详细说明 ChickenStack 的语法规则。

## 基本语法

### 1. 代码结构

ChickenStack 代码由一系列指令组成，指令之间用空格分隔：

```ch
# 基本结构
指令1 指令2 指令3 ...

# 示例
5 3 + .
```

### 2. 空格分隔

所有指令之间必须用空格分隔：

```ch
# 正确
5 3 + .

# 错误
53+.  # 无法正确解析
```

**注意事项**:
- 使用空格（Space）或制表符（Tab）
- 建议使用单个空格，保持代码清晰
- 多个空格也是允许的

### 3. 换行

换行符被视为空格，可以用于提高可读性：

```ch
# 单行代码
5 3 + .

# 多行代码（等价）
5
3
+
.
```

### 4. 注释

使用 `#` 添加注释，`#` 后面的内容会被忽略：

```ch
# 这是一个注释
5 3 + .  # 计算 5 + 3

# 多行注释
# 第一行注释
# 第二行注释
10 20 + .
```

## 数据语法

### 数字字面量

ChickenStack 支持任意位数的整数：

```ch
# 单个数字
5
3
0
9

# 多位数字
10
100
999
123456789

# 负数（通过减法实现）
5 10 - .  # 输出: -5
```

**规则**:
- 只支持整数
- 不支持浮点数
- 不支持十六进制、八进制等
- 数字之间必须用空格分隔

### 字符

字符通过 ASCII 码表示：

```ch
# 字符 'A' 的 ASCII 码是 65
65 "  # 输出: A

# 字符串 "HELLO"
72 " 69 " 76 " 76 " 79 " 10 "  # 输出: HELLO

# 特殊字符
10 "  # 换行
32 "  # 空格
48 "  # '0'
```

## 运算符语法

### 双目运算符

双目运算符需要两个操作数：

```ch
# 语法: 操作数1 操作数2 运算符
5 3 +   # 5 + 3
10 4 -  # 10 - 4
6 7 *   # 6 * 7
20 4 /  # 20 / 4
```

**执行顺序**:
1. 先弹出右操作数
2. 再弹出左操作数
3. 执行运算
4. 推入结果

**示例**:
```ch
# 计算 10 - 5
10 5 - .
# 执行过程:
# 1. 弹出 5 (右操作数)
# 2. 弹出 10 (左操作数)
# 3. 计算 10 - 5 = 5
# 4. 推入 5
```

### 单目运算符

```ch
# 复制栈顶
5 : .

# 丢弃栈顶
10 20 $ .
```

## 表达式语法

### 简单表达式

```ch
# 加法
5 3 + .

# 减法
10 4 - .

# 乘法
6 7 * .

# 除法
20 4 / .
```

### 复杂表达式

ChickenStack 使用逆波兰表达式，运算符在操作数之后：

```ch
# (10 + 20) * 2 = 60
10 20 + 2 * .

# 100 - (50 / 5) + 10 = 100
100 50 5 / - 10 + .

# ((5 + 3) * 2) - (10 / 2) = 12
5 3 + 2 * 10 2 / - .
```

**转换规则**:
- 中缀表达式: `a + b`
- 后缀表达式: `a b +`

**转换示例**:
```
中缀: (5 + 3) * 2
后缀: 5 3 + 2 *

中缀: 10 - (5 + 3)
后缀: 10 5 3 + -
```

## 循环语法

### 基本循环

```ch
# 语法: 计数器 [ 循环体 ]
5 [ : . 1 - ]
```

**执行逻辑**:
1. 检查栈顶是否为 0
2. 如果为 0，跳过循环
3. 如果不为 0，执行循环体
4. 跳回 `[` 重复检查

### 循环条件

```ch
# 栈顶为 0，不执行
0 [ 5 . ]  # 不输出

# 栈顶不为 0，执行
1 [ 5 . ]  # 输出: 5
```

### 嵌套循环

```ch
# 外层循环 3 次，内层循环 5 次
3 [ : 5 [ : . 1 - ] 10 " 1 - ]
```

### 循环配对

`[` 和 `]` 必须配对：

```ch
# 正确
5 [ : . 1 - ]

# 错误: 缺少 ]
5 [ : .

# 错误: 多余的 ]
5 [ : . ] ]
```

## 逻辑运算语法

### 相等判断

```ch
# 语法: 值1 值2 =
5 5 = .  # 输出: 1 (相等)
5 3 = .  # 输出: 0 (不相等)
```

### 大小比较

```ch
# 语法: 值1 值2 >
10 5 > .  # 输出: 1 (10 > 5)
5 10 > .  # 输出: 0 (5 不大于 10)
```

### 条件表达式

```ch
# 模拟三元运算符: condition ? a : b
condition a b > a b \ . .
```

## 输入输出语法

### 输出数字

```ch
# 语法: 值 .
42 .  # 输出: 42
```

### 输出字符

```ch
# 语法: ASCII码 "
65 "  # 输出: A
```

### 输入数字

```ch
# 语法: ,
, .  # 读取数字并输出
```

### 输入字符

```ch
# 语法: ?
? "  # 读取字符并输出
```

## 栈操作语法

### 复制

```ch
# 语法: :
5 : . .  # 输出: 5 5
```

### 交换

```ch
# 语法: \
1 2 \ . .  # 输出: 2 1
```

### 丢弃

```ch
# 语法: $
10 20 $ .  # 输出: 10
```

## 语法规则总结

### 必须遵守的规则

1. **空格分隔**: 指令之间必须用空格分隔
2. **循环配对**: `[` 和 `]` 必须配对
3. **栈充足**: 运算前栈必须有足够的元素
4. **整数运算**: 只支持整数运算

### 建议遵守的规则

1. **使用注释**: 为复杂逻辑添加注释
2. **合理换行**: 将复杂表达式拆分为多行
3. **命名规范**: 为文件和变量使用有意义的名称
4. **代码风格**: 保持一致的代码风格

## 语法错误

### 常见语法错误

#### 1. 缺少空格

```ch
# 错误
53+.

# 正确
5 3 + .
```

#### 2. 循环不配对

```ch
# 错误: 缺少 ]
5 [ : .

# 错误: 多余的 ]
5 [ : . ] ]

# 正确
5 [ : . 1 - ]
```

#### 3. 栈空错误

```ch
# 错误: 栈为空
+

# 正确: 先推入数据
5 3 + .
```

#### 4. 运算符顺序错误

```ch
# 错误理解: 想要 5 - 10
5 10 - .  # 实际输出: -5

# 正确: 10 - 5
10 5 - .  # 输出: 5
```

## 语法最佳实践

### 1. 代码格式化

```ch
# 推荐: 清晰的格式
# 计算 (10 + 20) * 2
10 20 + 2 * .

# 推荐: 多行格式
# 计算 ((5 + 3) * 2) - (10 / 2)
5 3 + 2 *
10 2 / -
.
```

### 2. 使用注释

```ch
# 添加注释说明
# 计算阶乘: 5! = 120
5 1 5 [ : * 1 - ] .
```

### 3. 分段编写

```ch
# 将复杂表达式分段
# 第一部分: 计算 a + b
a b +

# 第二部分: 保存结果
:

# 第三部分: 计算 c * d
c d *

# 第四部分: 最终计算
+ .
```

### 4. 调试友好

```ch
# 添加调试输出
5 3 + .  # 输出中间结果
10 20 + .  # 输出中间结果
```

## 语法示例

### 示例1: 完整程序

```ch
# ChickenStack 完整示例

# 1. 基本运算
5 3 + .      # 输出: 8
10 4 - .     # 输出: 6
6 7 * .      # 输出: 42

# 2. 复杂表达式
10 20 + 2 * .  # 输出: 60

# 3. 栈操作
5 : . .      # 输出: 5 5

# 4. 字符输出
72 " 69 " 76 " 76 " 79 " 10 "  # 输出: HELLO

# 5. 循环
5 [ : . 1 - ]  # 输出: 5 4 3 2 1
```

### 示例2: 数学计算

```ch
# 计算多项式: 3x² + 2x + 1，其中 x = 5
5 : * 3 *  # 3x²
5 2 * +    # + 2x
1 + .      # + 1
```

### 示例3: 字符串处理

```ch
# 反转字符串 "ABC"
65 " 66 " 67 "  # 推入 A B C
: . : . : .     # 打印 C B A
```

### 示例4: 算法实现

```ch
# 计算最大公约数 (GCD)
48 18 [ : \ ] .
```

## 语法限制

### 当前限制

1. **不支持变量**: 无法定义和使用变量
2. **不支持函数**: 无法定义和调用函数
3. **不支持浮点数**: 只支持整数运算
4. **不支持数组**: 无法使用数组数据结构
5. **不支持字符串**: 只能通过 ASCII 码处理字符

### 变通方法

```ch
# 模拟变量: 使用栈位置
5 :  # 推入5并复制，模拟变量
3 + .  # 使用变量

# 模拟函数: 使用循环
10 [ : . 1 - ]  # 模拟函数调用

# 模拟浮点数: 使用整数
314 100 /  # 模拟 3.14
```

## 语法扩展

### 未来可能的扩展

1. **变量支持**: `var x = 5`
2. **函数定义**: `func add(a, b) { a b + }`
3. **浮点数**: `3.14`
4. **字符串**: `"Hello"`
5. **数组**: `[1, 2, 3]`

## 学习建议

1. **从简单开始**: 先掌握基本语法
2. **实践为主**: 多写代码练习
3. **理解栈**: 理解栈的工作原理
4. **调试技巧**: 学会调试代码
5. **阅读示例**: 参考他人的代码

---

本文档由 AI GLM-4.7 生成